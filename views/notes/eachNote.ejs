<style>
  body {
    background: linear-gradient(to right, #f8f9fa, #eef1f7);
  }

  .badge-warning {
  background-color: #ff5900;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-left: 0.5rem;
}




</style>

<link rel="stylesheet" href="/css/eachNoteCss.css">

<section class="note-detail-container">
  <div class="note-card">
    <div class="note-card-header">
      <div>
        <h2 class="note-title"><%= note.title %></h2>
        <% if(!note.isVerified) { %>
          <span class="badge-unverified">Unverified</span>
        <% } %>
      </div>
      <% if(currUser && (currUser._id.toString() === note.uploadedBy?._id?.toString() || currUser.roles?.isModerator)) { %>
        <div class="owner-actions">
          <a href="/notes/<%= note._id %>/edit" class="btn-edit" title="Edit">‚úèÔ∏è</a>
          <form action="/notes/<%= note._id %>?_method=DELETE" method="POST">
            <button type="submit" class="btn-delete" title="Delete" onclick="return confirm('Delete this note?')">üóëÔ∏è</button>
          </form>
        </div>
      <% } %>
    </div>
    <div class="note-meta">
      <span class="uploader">
        <i class="fa fa-user"></i> <%= note.uploadedBy?.name || 'Unknown' %>
        <% if (note.uploadedBy?.roles.isModerator) { %>
            <img src="/images/blueCheckmark.svg" alt="Moderator" style="all: unset; width: 18px;">
        <% } else if (note.uploadedBy?.roles.isDev) { %>
            <img src="/images/icons8-checkmark.svg" alt="Developer" style="all: unset; width: 18px;">
        <% } %>
      </span>

      <span class="meta-info">
        <span><i class="fa fa-calendar"></i> <%= note.createdAt?.toLocaleDateString('en-IN', {day:'numeric', month:'short', year:'numeric'}) %></span>
        <span><i class="fa fa-download"></i> <%= note.downloadCount %> downloads</span>
      </span>
    </div>


    <div class="note-main-content">
      <div class="note-preview">
        <% if(!note.isVerified) { %>
          <div class="flash-error">
            ‚è≥ Waiting for moderator approval. Contact <a href="/our-team">our team</a>.
          </div>
        <% } %>
        <% if (note.fileUrl.toLowerCase().endsWith('.pdf')) { %>
          <iframe src="<%= note.fileUrl %>#toolbar=0" class="note-preview-frame"></iframe>
        <% } else if (/\.(jpg|jpeg|png|gif)$/i.test(note.fileUrl)) { %>
          <img src="<%= note.fileUrl %>" class="note-preview-img">
        <% } else { %>
          <div class="no-preview-text">No preview available.</div>
        <% } %>
      </div>
      <div class="note-info">
        <div class="note-details">
          <h4>Details</h4>
          <ul>
            <li><strong>Subject:</strong> <%= note.subject?.name || 'N/A' %></li>
            <li><strong>Course:</strong> <%= note.course || 'N/A' %></li>
            <li><strong>Semester:</strong> <%= note.semester || 'N/A' %></li>
            <li><strong>Visibility:</strong> <%= note.visibility %></li>
          </ul>
        </div>
        <div class="note-description">
          <h4>Description</h4>
          <p><%= note.description || 'No description provided.' %></p>
        </div>
        <div class="note-actions">
          <a href="/notes/<%= note._id %>/download" class="btn-download">Download</a>
          <form action="/notes/<%= note._id %>/upvote" method="POST">
            <button class="btn-upvote">Upvote (<%= note.upvotes.length %>)</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</section>
