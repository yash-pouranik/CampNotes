<style>
  body {
    background: linear-gradient(to right, #f8f9fa, #eef1f7);
  }

  .badge-warning {
  background-color: #ff5900;
  color: white;
  padding: 2px 6px;
  border-radius: 4px;
  font-size: 0.8rem;
  margin-left: 0.5rem;
}




</style>

<link rel="stylesheet" href="/css/eachNoteCss.css">


<section class="note-detail">
  <h1 style="margin-top: 0;"><%= note.title %>
  <% if (!note.isVerified) { %>
    <span class="badge badge-warning">Unverified</span>
  <% } %></h1>

  <% 
    const isPdf = note.fileUrl?.toLowerCase().endsWith(".pdf"); 
    const isImage = /\.(jpg|jpeg|png|gif)$/i.test(note.fileUrl || "");
  %>

  <div class="preview-area" style="margin-top: 30px;">

      <% if (!note.isVerified) { %>
        <div class="flash flash-error">Wait or contact moderator inside /our-team(in footer-bottom) to be verified.</div>
      <% } %>

    <div class="preview" style="display: flex; align-items: center; justify-content: space-between;">
      <h2 style="font-size: 1.4rem; margin-bottom: 15px; color: #2b2b6b;">Preview:</h2>
      <% if(currUser && (
        currUser._id.toString() === note.uploadedBy?._id?.toString() || 
        currUser.roles?.isModerator
      )) { %>
        <div class="operations">
          <a href="/notes/<%= note._id %>/edit" class="edit-btn">edit</a>
          <form action="/notes/<%= note._id %>?_method=DELETE" method="POST" style="display:inline;">
            <button type="submit" class="dlt-btn" onclick="return confirm('Are you sure you want to delete this note?');">
              delete
            </button>
          </form>

        </div>
      <% } %>
    </div>

    <% if (isPdf) { %>
      <iframe src="<%= note.fileUrl %>#toolbar=0" width="100%" height="300px" style="border: 1px solid #ccc; border-radius: 8px;"></iframe>
    <% } else if (isImage) { %>
      <img src="<%= note.fileUrl %>" alt="Note Image" style="max-width: 100%; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);" />
    <% } else { %>
      <p style="color: #888;">No preview available for this file type.</p>
    <% } %>
  </div>

  <p><strong>Subject:</strong> <%= note.subject?.name || 'N/A' %></p>
  <p><strong>Course:</strong> <%= note.course || 'N/A' %></p>
  <p><strong>Visibility:</strong> <%= note.visibility %></p>

  <p><strong>Description:</strong></p>
  <p><%= note.description || 'No description provided.' %></p>

  <p style="display: flex; align-items: center;">
    <strong>Uploaded by:</strong> <%= note.uploadedBy?.name || note.uploadedBy?.username || "Unknown" %>
    <% if (note.uploadedBy?.roles?.isModerator) { %>
      <img src="/images/blueCheckmark.svg" alt="Moderator" style="all: unset; width: 23px;">
    <% } else if (note.uploadedBy?.roles?.isDev) { %>
      <img src="/images/icons8-checkmark.svg" alt="Developer" style="all: unset; width: 23px;">
    <% } else if (note.uploadedBy?.verification?.verified) { %>
      <span style="color: green; font-size: 0.8rem;">‚úî</span>
    <% } %>
  </p>

  <p><strong>Downloads:</strong> <%= note.downloadCount %></p>

  <p><strong>Uploaded at:</strong> <%= note.createdAt ? note.createdAt.toLocaleDateString('en-IN', { day: 'numeric', month: 'short', year: 'numeric' }) : 'Date not available' %>
</p>



  <div class="action-buttons">
  <a class="download-btn" href="/notes/<%= note._id %>/download" target="_blank">
    üì• Download
  </a>

  <form action="/notes/<%= note._id %>/upvote" method="POST" style="display:inline;">
    <button type="submit" class="upvote-btn">
      üëç Upvote (<%= note.upvotes.length %>)
    </button>
  </form>
</div>



    
</section>

